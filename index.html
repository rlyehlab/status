<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>

    <title>R'lyeh Hacklab | Status</title>
    <meta name="author" content="HacKan"/>
    <meta name="description" content="R'lyeh Hacklab Status Page"/>

    <link rel="icon" href="assets/imgs/favicon.png" sizes="32x32" type="image/png"/>

    <link rel="stylesheet" href="assets/css/fontawesome.min.css?v=5.1.1"/>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css?v=4.1.2"/>
    <link rel="stylesheet" href="assets/css/cover.min.css?cache=20180725"/>

    <meta name="apple-mobile-web-app-capable" content="yes"/>
</head>
<body class="text-center">
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="masthead mb-auto">
        <div class="inner">
            <img class="masthead-brand" src="assets/imgs/title.png" alt="" width="166" height="68"/>
            <nav class="nav nav-masthead justify-content-center">
                <a class="nav-link active" href="#" title="Home"><span class="fas fa-home"
                                                                       aria-hidden="true"></span></a>
                <a class="nav-link" href="https://wiki.rlab.be" title="Wiki"><span class="fab fa-wikipedia-w"
                                                                                   aria-hidden="true"></span></a>
                <a class="nav-link" href="https://agenda.rlab.be" title="Agenda"><span class="far fa-calendar-alt"
                                                                                       aria-hidden="true"></span></a>
                <a class="nav-link" href="https://webmail.rlab.be" title="Webmail"><span class="fas fa-envelope"
                                                                                         aria-hidden="true"></span></a>
                <a class="nav-link" href="https://git.rlab.be" title="Gitlab"><span class="fab fa-gitlab"
                                                                                    aria-hidden="true"></span></a>
                <a class="nav-link" href="https://talk.rlab.be" title="Discourse"><span class="fab fa-discourse"
                                                                                        aria-hidden="true"></span></a>
                <a class="nav-link" href="https://matrix.rlab.be" title="Matrix"><span class="far fa-comments"
                                                                                       aria-hidden="true"></span></a>
                <a class="nav-link" href="https://pad.rlab.be" title="Pad"><span class="far fa-sticky-note"
                                                                                 aria-hidden="true"></span></a>
                <a class="nav-link" href="https://antifa-glug.org" title="Antifa GLUG"><span class="fas fa-globe"
                                                                                             aria-hidden="true"></span></a>
                <a class="nav-link" href="https://wiki.antifa-glug.org" title="Antifa GLUG"><span
                        class="fab fa-wikipedia-w" aria-hidden="true"></span></a>
                <a class="nav-link" href="https://blog.adm.rlab.be" title="Sysadmin's Blog"><span
                        class="fas fa-globe" aria-hidden="true"></span></a>
            </nav>
        </div>
    </header>

    <main role="main" class="inner cover">
        <h1 class="cover-heading">Services | Status</h1>
        <p class="lead">This site reports the status of our public services.
        The information shown is refreshed every 60 seconds.</p>
        <p>For more information, contact us via <a href="https://twitter.com/rlyehlab">Twitter</a> or Telegram.</p>
        <div class="table-responsive">
            <table class="table table-hover table-sm">
                <thead>
                <tr>
                    <th scope="col">Service</th>
                    <th scope="col">Status</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Web</td>
                    <td id="416ff55a"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Email</td>
                    <td id="9804b632"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Discourse</td>
                    <td id="ce706262"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Wiki</td>
                    <td id="166ed7e5"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Agenda</td>
                    <td id="76dec832"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Gitlab</td>
                    <td id="48fd875c"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Matrix</td>
                    <td id="4c270ee6"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Pad</td>
                    <td id="103bae91"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Antifa GLUG Web</td>
                    <td id="c7cbbb24"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Antifa GLUG Wiki</td>
                    <td id="90fef32a"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                <tr>
                    <td>Sysadmin's Blog</td>
                    <td id="8549cde2"><span class="fas fa-question" style="color: yellow;"></span></td>
                </tr>
                </tbody>
            </table>
        </div>
        <p><span class="fas fa-clock" title="Last updated"></span> <strong id="date">unknown</strong></p>
    </main>

    <footer class="mastfoot mt-auto">
        <div class="inner">
            <p>Based on Cover template for <a href="https://getbootstrap.com">Bootstrap</a>, by <a
                    href="https://twitter.com/mdo">@mdo</a>. Uses pretty <a href="https://fontawesome.com/icons">Fontawesome
                Icons</a>. <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img
                    src="assets/imgs/cc-by-nc-sa-4.png" alt="CC BY-NC-SA 4.0" width="80" height="15"/></a>.</p>
        </div>
    </footer>
</div>

<script src="assets/js/jquery-3.3.1.min.js" defer></script>
<script src="assets/js/bootstrap.min.js" async defer></script>
<script async defer>
    function prettyDate(date) {
        // https://stackoverflow.com/questions/7197270/javascript-convert-datetime-to-pretty-date-strange-format/25615167#25615167
        let secs = Math.floor((Date.now() - date.getTime()) / 1000);
        if (secs < 60) return secs + " sec(s) ago";
        if (secs < 3600) return Math.floor(secs / 60) + " min(s) ago";
        if (secs < 86400) return Math.floor(secs / 3600) + " hour(s) ago";
        if (secs < 604800) return Math.floor(secs / 86400) + " day(s) ago";
        return date.toLocaleString();
    }

    function setServiceStatus() {
        $.getJSON("data/healthcheck.json", function (data) {
            const html_down = '<span class="far fa-thumbs-down" style="color: red;">';
            const html_up = '<span class="far fa-thumbs-up" style="color: green;">';
            for (let i = 0; i < data.length; i++) {
                let service = data[i];
                let status = service.ok ? html_up : html_down;
                let selector = '#' + service.uid;
                if ($(selector).length) {
                    $(selector).html(status);
                }
            }
        });
    }

    function setStatusDate() {
        $.getJSON("https://api.github.com/repos/rlyehlab/status/commits?path=data/healthcheck.json", function (data) {
            if (data.length) {
                let utc_date_string = data[0].commit.committer.date;
                let utc_date = new Date(utc_date_string);
                $('#date').html(prettyDate(utc_date));
                $('#date').prop('title', utc_date.toString())
            }
        });
    }

    function update() {
        setServiceStatus();
        setStatusDate();
    }

    window.onload = function() {
        update();
        setInterval(update, 60000);
    }
</script>
</body>
</html>
